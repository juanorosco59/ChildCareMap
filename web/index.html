<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ChildCareMap</title>
    <link id="page-style" rel="stylesheet">
</head>


<body>

    <!-- ================================================================================= -->
    <!--                               Pantalla de login                                   -->
    <!-- ================================================================================= -->

    <div id="login-screen">
        <div class="login-container">

            <div class="login-header">
                <div class="logo-icon">
                        <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z" />
                            <circle cx="12" cy="10" r="3" />
                        </svg>
                </div>

                <h1>ChildCareMap</h1>
                <p>Sistema de mapeo de anemia infantil</p>
            </div>

            <!-- Formulario de login -->
            <div class="login-card">
                <form id="login-form">
                    <div class="form-group">
                        <label>Correo electrónico</label>
                        <div class="input-wrapper">
                            <input type="email" id="email" required autocomplete="email" placeholder="usuario@childcaremap.com">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Contraseña</label>
                        <div class="input-wrapper">
                            <input type="password" id="password" required autocomplete="current-password"
                                placeholder="••••••••">
                        </div>
                    </div>

                    <button type="submit" class="login-button">Iniciar sesión</button>
                </form>
            </div>

            <div class="login-footer">
                <p>© 2025 ChildCareMap</p>
            </div>

        </div>
    </div>



    <!-- ================================================================================= -->
    <!--                                 Dashboard                                         -->
    <!-- ================================================================================= -->

    <div id="dashboard-screen" style="display:none;">

        <div class="dashboard-panel">
            <div class="dashboard-container">

                <!-- Encabezado del dashboard -->
                <div class="header">
                    <div class="logo-icon">
                        <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z" />
                            <circle cx="12" cy="10" r="3" />
                        </svg>
                    </div>

                    <div class="logo-text">
                        <h1>ChildCareMap</h1>
                        <p>Sistema de mapeo de anemia</p>
                    </div>
                </div>

                <!-- Alerta resumida -->
                <div class="alert alert-critical">
                    <strong>Hay 5 comunidades con riesgo crítico</strong>
                </div>

                <!-- Tarjetas estadísticas -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Anemia crónica</div>
                        <div class="stat-value">11.5%</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Anemia regular</div>
                        <div class="stat-value">36.7%</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Anemia aguda</div>
                        <div class="stat-value">0.4%</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Comunidades críticas</div>
                        <div class="stat-value">5</div>
                    </div>
                </div>

                <!-- Navegación por pestañas -->
                <div class="tabs">
                    <div class="tabs-list">
                        <button class="tab-trigger" data-tab="resumen">Resumen</button>
                        <button class="tab-trigger active" data-tab="mapa">Mapa</button>
                        <button class="tab-trigger" data-tab="datos">Datos</button>
                    </div>

                    <!-- Contenidos de pestañas -->
                    <div class="tab-content" data-content="resumen">
                        <div class="tab-panel">Vista de resumen</div>
                    </div>

                    <div class="tab-content active" data-content="mapa">
                        <div class="tab-panel">
                            <h3>Mapa de comunidades vulnerables</h3>
                            <p>Distribución geográfica de niños con anemia en el Perú</p>
                        </div>
                    </div>

                    <div class="tab-content" data-content="datos">
                        <div class="tab-panel">Vista de datos</div>
                    </div>
                </div>

            </div>
        </div>

        <!-- Contenedor donde se monta SIGMA / Leaflet -->
        <div id="sigma-container"></div>

        <!-- Controles del mapa -->
        <div class="map-controls">
            <button id="zoom-in">Acercar</button>
            <button id="zoom-out">Alejar</button>
            <button id="zoom-reset">Restablecer</button>

            <label>
                Umbral de etiquetas:
                <input type="range" id="labels-threshold" min="0" max="10" />
            </label>
        </div>

        <!-- Botón de cierre de sesión -->
        <button id="logout-btn" class="logout">Cerrar sesión</button>

    </div>



    <!-- ================================================================================= -->
    <!--                             Lógica - Login / Dashboard                            -->
    <!-- ================================================================================= -->

<script type="module">

    // Referencias a elementos clave de la interfaz
    const styleTag = document.getElementById("page-style");
    const loginScreen = document.getElementById("login-screen");
    const dashboardScreen = document.getElementById("dashboard-screen");

    // Estado persistente de sesión (simple)
    const notVisited = localStorage.getItem("notVisited");

    /* 
      Si no existe "visited", significa que el usuario nunca inició sesión.
      Entonces cargamos primero el login.
    */
    if (!notVisited) {
        showLogin();
    } else {
        showDashboard();
    }

    // Mostrar pantalla de login y aplicar estilos correspondientes
    function showLogin() {
        styleTag.href = "style/login.css";
        loginScreen.style.display = "block";
        dashboardScreen.style.display = "none";
    }

    // Mostrar dashboard, cargar estilos y módulos necesarios
    function showDashboard() {
        styleTag.href = "style/dashboard.css";
        loginScreen.style.display = "none";
        dashboardScreen.style.display = "block";

        // Inicializar el mapa / SIGMA
        import("./js/mainPro.js").then(m => m.default());
    }

    // Evento de inicio de sesión
    document.getElementById("login-form").addEventListener("submit", (e) => {
        e.preventDefault();

        localStorage.setItem("notVisited", "true"); // Marcamos como logueado
        showDashboard();
    });

    // Evento de cierre de sesión
    document.getElementById("logout-btn").addEventListener("click", () => {
        localStorage.removeItem("notVisited"); // Limpiamos estado
        showLogin();
    });

</script>

</body>

</html>
